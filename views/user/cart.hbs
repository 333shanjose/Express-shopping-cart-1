<table class="table">
  <thead>
    <tr>
      
      <th scope="col">iteam</th>
      <th scope="col">title</th>
       <th scope="col">Price</th>
      <th scope="col">quantity</th>
      
    </tr>
  </thead>
  <tbody>
    {{#each products}}
     <tr>
      
      <td><img style="width:70px;height:70px" src="/productimages/{{this.product._id}}.jpg" alt=""></td>
      <td>{{this.product.name}}</td>
      <td>{{this.product.Price}}</td>
      
      <td><button class="cart-item-count mr-3" onclick="changeQuantity('{{this._id}}','{{ this.product._id}}','{{../user}}',-1)">-</button>
      <span id="{{this.product._id}}">{{this.quantity}}</span>
      <button class="cart-item-count ml-3"  onclick="changeQuantity('{{this._id}}','{{this.product._id }}','{{../user}}',1)">+</button></td>
      <td><button class="btn btn-danger" onclick="remove('{{this._id}}','{{this.product._id}}')">remove</a></td>
    </tr>
   
    {{/each}}
    
   
    
    
  </tbody>
</table>
<hr>
<div class="float-right pr-5">
<h3 class="float-left mr-5">TOTAL:Rs.<span id="total">{{total}}</span></h3>
<a href="/placeorder/" class="btn btn-success  mt-3" style="width:100%";><b>placeorder</b></a> 
</div>
<script>
    function changeQuantity(cartId,productId,userId,count){
      let quantity=parseInt(document.getElementById(productId).innerHTML)
      $.ajax({
          url:"/change-product/",
          data:{
            user:userId,
            cart:cartId,
            proId:productId,
            count:count,
            quantity:quantity
            
          },
          method:"post",
          success:(response)=>{
            if(response.removeproduct){
            alert("product removed")
            location.reload()
          }else {
          
            document.getElementById(productId).innerHTML=count+quantity
            document.getElementById("total").innerHTML=response.total
            
          }
          }
      })
    }
</script>
<script>
  function remove(cartId,productId){
    $.ajax({
      url:"/removeProduct/",
      data:{
        cart:cartId,
        proId:productId
      },
      method:"post",
      success:(response)=>{
        alert("product removed")
        location.reload()
        
      }
      
        
      


    })
  }
</script>
